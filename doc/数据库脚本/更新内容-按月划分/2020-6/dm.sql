/** 
 * 开发平台服务API定义模块复制到业务平台中，支持大屏在线定制开发
 * @param null	
 * @return 
 * @author zuogang
 * @date 2020/6/3 8:32
 */
CREATE TABLE "SYS_APP_INTERFACE"
(
"ID" VARCHAR2(50) NOT NULL,
"APP_ID" VARCHAR2(50),
"NAME" VARCHAR2(50),
"IS_PAGE_GET" INTEGER,
"SQL_CONTENT" CLOB,
"CREATE_TIME" DATETIME(6),
"DESCRIPTION" VARCHAR2(200),
NOT CLUSTER PRIMARY KEY("ID"),
CONSTRAINT "FK_APP_INTERFACE_APP_ID" FOREIGN KEY("APP_ID") REFERENCES "SYS_GROUP_APP"("ID") ON DELETE CASCADE ON UPDATE CASCADE);
COMMENT ON TABLE "SYS_APP_INTERFACE" IS '应用接口信息表';
COMMENT ON COLUMN "SYS_APP_INTERFACE"."APP_ID" IS '应用ID';
COMMENT ON COLUMN "SYS_APP_INTERFACE"."CREATE_TIME" IS '创建时间';
COMMENT ON COLUMN "SYS_APP_INTERFACE"."DESCRIPTION" IS '描述';
COMMENT ON COLUMN "SYS_APP_INTERFACE"."ID" IS '主键';
COMMENT ON COLUMN "SYS_APP_INTERFACE"."IS_PAGE_GET" IS '是否分页方法,0否1是';
COMMENT ON COLUMN "SYS_APP_INTERFACE"."NAME" IS '接口名';
COMMENT ON COLUMN "SYS_APP_INTERFACE"."SQL_CONTENT" IS 'sql语句';

CREATE TABLE "SYS_APP_INTERFACE_INPUT"
(
"ID" VARCHAR2(50) NOT NULL,
"PARAM_KEY" VARCHAR2(50),
"PARAM_DEFAULT_VALUE" VARCHAR2(100),
"PARAM_TYPE" VARCHAR2(50),
"INTERFACE_ID" VARCHAR2(50),
NOT CLUSTER PRIMARY KEY("ID"),
CONSTRAINT "FK_INPUT_INTERFACE_ID" FOREIGN KEY("INTERFACE_ID") REFERENCES "SYS_APP_INTERFACE"("ID") ON DELETE CASCADE ON UPDATE CASCADE);
COMMENT ON TABLE "SYS_APP_INTERFACE_INPUT" IS '接口sql入参信息表';
COMMENT ON COLUMN "SYS_APP_INTERFACE_INPUT"."ID" IS '主键';
COMMENT ON COLUMN "SYS_APP_INTERFACE_INPUT"."INTERFACE_ID" IS '接口主键';
COMMENT ON COLUMN "SYS_APP_INTERFACE_INPUT"."PARAM_DEFAULT_VALUE" IS '缺省值';
COMMENT ON COLUMN "SYS_APP_INTERFACE_INPUT"."PARAM_KEY" IS '键';
COMMENT ON COLUMN "SYS_APP_INTERFACE_INPUT"."PARAM_TYPE" IS '参数类型';

CREATE TABLE "SYS_APP_INTERFACE_OUTPUT"
(
"ID" VARCHAR2(50) NOT NULL,
"PARAM_KEY" VARCHAR2(50),
"PARAM_TYPE" VARCHAR2(50),
"INTERFACE_ID" VARCHAR2(50),
"PARAM_LABEL" VARCHAR2(100),
NOT CLUSTER PRIMARY KEY("ID"),
CONSTRAINT "FK_OUTPUT_INTERFACE_ID" FOREIGN KEY("INTERFACE_ID") REFERENCES "SYS_APP_INTERFACE"("ID") ON DELETE CASCADE  ON UPDATE CASCADE );
COMMENT ON TABLE "SYS_APP_INTERFACE_OUTPUT" IS '接口sql出参信息表';
COMMENT ON COLUMN "SYS_APP_INTERFACE_OUTPUT"."ID" IS '主键';
COMMENT ON COLUMN "SYS_APP_INTERFACE_OUTPUT"."INTERFACE_ID" IS '接口主键';
COMMENT ON COLUMN "SYS_APP_INTERFACE_OUTPUT"."PARAM_KEY" IS '键';
COMMENT ON COLUMN "SYS_APP_INTERFACE_OUTPUT"."PARAM_TYPE" IS '参数类型';
COMMENT ON COLUMN "SYS_APP_INTERFACE_OUTPUT"."PARAM_LABEL" IS '字段注释';

/**
 * 报表添加数据源
 *
 * @author shanwj
 * @date 2020/6/3 9:31
 */
alter table "REPORT_INFO" add column("DATASOURCE_ID" VARCHAR2(2000));
comment on column "REPORT_INFO"."DATASOURCE_ID" is '数据源id';

alter table "SYS_GROUP_APP" DROP CONSTRAINT FK_SYS_GROUP_APP_DS_ID;

/**
 *  为应用管理员添加接口管理菜单
 * @param null
 * @return
 * @author zuogang
 * @date 2020/6/3 14:10
 */
insert into "SYS_AUTH" ("ID","NAME","APP_ID","REMARK","SORT_INDEX","PARENT_ID","CREATE_USER","CREATE_TIME","UPDATE_TIME","SORT_PATH","IS_ORG_ADMIN","IS_USER_GROUP_ADMIN","CODE","DATA_VERSION") values ('byasmd7ea4a4e54acdaff4yhmzq8370', '接口管理', 'platform', null,15, '11316279a4a9416a8e20019821e640af', null, null, null, '00030015', 0, 0, 'platForm.interfaceManage.Interface', 0);

insert into "SYS_MENU" ("ID","NAME","PARENT_ID","APP_ID","PARENT_NAME","URL","TYPE","ICON","AUTH_ID","BTN_AUTH","IS_LEAF","SORT_INDEX","ALL_ORDER","SORT_PATH","OPEN_STYLE","CLOSE_NOTICE","CREATE_USER","CREATE_TIME","UPDATE_TIME","LEAF","MENU_AUTH","REMARK","DATA_VERSION","IS_IFRAME") values ('byasmd7ea4a4e54acdaff4yhmzq8370', '接口管理', '11316279a4a9416a8e20019821e640af', 'platform', '配置管理', 'interfaceManage/views/Interface', 1, 'fa fa-window-restore', 'byasmd7ea4a4e54acdaff4yhmzq8370', null, null, 15, null, '00030015', null, null, null, null, null, null, null, null, 0, 0);

insert into "SYS_AUTH_ROLE" ("ID","AUTH_ID","ROLE_ID","SIGN","IS_REVOKE","CREATE_USER","CREATE_TIME","UPDATE_TIME","REMARK") values ('byasmd7ea4a4e54acdaff4yhmzq8370', 'byasmd7ea4a4e54acdaff4yhmzq8370', 'appadmin', null, 0, null, null, null, null);

insert into "SYS_AUTH_ROLE_V" ("ID","AUTH_ID","ROLE_ID","SIGN","IS_REVOKE","CREATE_USER","CREATE_TIME","UPDATE_TIME","REMARK","LV_ID") values ('byasmd7ea4a4e54acdaff4yhmzq8370', 'byasmd7ea4a4e54acdaff4yhmzq8370', 'appadmin', null, 0, null, null, null, null, 'appadmin');

/**
 *  数据源添加到应用下
 * @author shanwj
 * @date 2020/6/4 14:37
 */

alter table "SYS_GROUP_DATASOURCE" DROP CONSTRAINT FK_SYS_GROUP_DATASOURCE_GID;

alter table "SYS_GROUP_DATASOURCE" add column("APP_ID" VARCHAR2(50));
comment on column "SYS_GROUP_DATASOURCE"."APP_ID" is '应用id';

 ALTER TABLE "SYS_GROUP_DATASOURCE"
   ADD CONSTRAINT "SYS_GROUP_DATASOURCE_APP_ID" FOREIGN KEY ("APP_ID") REFERENCES "SYS_GROUP_APP"("ID")  on update cascade ON DELETE CASCADE;


/**
 *  添加大屏相关表
 * @param null
 * @return
 * @author zuogang
 * @date 2020/6/4 15:26
 */
COMMENT ON COLUMN "REPORT_TYPE"."TYPE" IS '类别类型 1报表2仪表盘3大屏';

CREATE TABLE "BLADE_VISUAL"
(
"ID" VARCHAR2(50) NOT NULL,
"TITLE" VARCHAR2(500),
"BACKGROUND_INFO" CLOB,
"CATEGORY" VARCHAR2(50),
"PASSWORD" VARCHAR2(255),
"CREATE_USER" VARCHAR2(50),
"CREATE_TIME" DATETIME(6),
"UPDATE_USER" VARCHAR2(50),
"UPDATE_TIME" DATETIME(6),
"STATUS" INTEGER,
"IS_DELETED" INTEGER,
"DETAIL" CLOB,
"COMPONENT" CLOB,
"APP_ID" VARCHAR2(50),
NOT CLUSTER PRIMARY KEY("ID"),
CONSTRAINT "FK_VISUAL_CATEGORY" FOREIGN KEY("CATEGORY") REFERENCES "REPORT_TYPE"("ID") ON DELETE CASCADE  ON UPDATE CASCADE ,
CONSTRAINT "FK_VISUAL_APP_ID" FOREIGN KEY("APP_ID") REFERENCES "SYS_GROUP_APP"("ID") ON DELETE CASCADE  ON UPDATE CASCADE );
COMMENT ON TABLE "BLADE_VISUAL" IS '大屏信息数据表';
COMMENT ON COLUMN "BLADE_VISUAL"."APP_ID" IS '应用ID';
COMMENT ON COLUMN "BLADE_VISUAL"."BACKGROUND_INFO" IS '大屏背景';
COMMENT ON COLUMN "BLADE_VISUAL"."COMPONENT" IS '组件json';
COMMENT ON COLUMN "BLADE_VISUAL"."CREATE_TIME" IS '创建时间';
COMMENT ON COLUMN "BLADE_VISUAL"."CREATE_USER" IS '创建人';
COMMENT ON COLUMN "BLADE_VISUAL"."DETAIL" IS '配置json';
COMMENT ON COLUMN "BLADE_VISUAL"."ID" IS '主键';
COMMENT ON COLUMN "BLADE_VISUAL"."IS_DELETED" IS '是否已删除0否1是';
COMMENT ON COLUMN "BLADE_VISUAL"."PASSWORD" IS '发布密码';
COMMENT ON COLUMN "BLADE_VISUAL"."STATUS" IS '状态';
COMMENT ON COLUMN "BLADE_VISUAL"."TITLE" IS '大屏标题';
COMMENT ON COLUMN "BLADE_VISUAL"."CATEGORY" IS '业务类型ID';
COMMENT ON COLUMN "BLADE_VISUAL"."UPDATE_TIME" IS '修改时间';
COMMENT ON COLUMN "BLADE_VISUAL"."UPDATE_USER" IS '修改人';

CREATE TABLE "BLADE_VISUAL_MAP"
(
"ID" VARCHAR2(50) NOT NULL,
"NAME" VARCHAR2(255),
"DATA" CLOB,
"APP_ID" VARCHAR2(50),
NOT CLUSTER PRIMARY KEY("ID"),
CONSTRAINT "FK_VISUAL_MAP_APP_ID" FOREIGN KEY("APP_ID") REFERENCES "SYS_GROUP_APP"("ID") ON DELETE CASCADE  ON UPDATE CASCADE );
COMMENT ON TABLE "BLADE_VISUAL_MAP" IS '可视化地图配置表';
COMMENT ON COLUMN "BLADE_VISUAL_MAP"."APP_ID" IS '应用ID';
COMMENT ON COLUMN "BLADE_VISUAL_MAP"."DATA" IS '地图数据';
COMMENT ON COLUMN "BLADE_VISUAL_MAP"."ID" IS '主键';
COMMENT ON COLUMN "BLADE_VISUAL_MAP"."NAME" IS '地图名称';


/** 
 * 数据源管理迁移到应用管理员下 
 * @param null	
 * @return 
 * @author zuogang
 * @date 2020/6/8 8:21
 */
UPDATE sys_auth_role SET role_id='appadmin' WHERE auth_id in ('39e1b3ec3d6e483b86c4923ea64cfeee','39e1b3ec3d6e483b86c4923ea64cf111');
UPDATE sys_auth_role_v SET role_id='appadmin',lv_id='appadmin' WHERE auth_id in ('39e1b3ec3d6e483b86c4923ea64cfeee','39e1b3ec3d6e483b86c4923ea64cf111');

alter table SYS_GROUP_DATASOURCE drop column GROUP_ID;

alter table "SYS_APP_INTERFACE" add column("DS_ID" VARCHAR2(50));
comment on column "SYS_APP_INTERFACE"."DS_ID" is '数据源ID';

ALTER TABLE "SYS_APP_INTERFACE"
   ADD CONSTRAINT "FK_APP_INTERFACE_DS_ID" FOREIGN KEY ("DS_ID") REFERENCES "SYS_GROUP_DATASOURCE"("ID")  on update cascade ON DELETE CASCADE;

/**
 * 修改文件切片存储路径长度
 * @author JonnyJiang
 * @date 2020/6/11 10:36
 */

alter table "FILE_CHUNK_INFO" modify "CHUNK_PATH" VARCHAR2(2000);

/** 
 *  
 * @param null	
 * @return 
 * @author zuogang
 * @date 2020/6/11 15:01
 */
alter table "SYS_APP_INTERFACE" add column("AUTH_ID" VARCHAR2(50));
comment on column "SYS_APP_INTERFACE"."AUTH_ID" is '权限id';
alter table "BLADE_VISUAL" add column("AUTH_ID" VARCHAR2(50));
comment on column "BLADE_VISUAL"."AUTH_ID" is '权限id';

/** 
 * 接口标识
 * @param null	
 * @return 
 * @author zuogang
 * @date 2020/6/15 10:11
 */
alter table "SYS_APP_INTERFACE" add column("CODE" VARCHAR2(50) NOT NULL);
comment on column "SYS_APP_INTERFACE"."CODE" is '接口标识';

insert into "SYS_AUTH" ("ID","NAME","APP_ID","REMARK","SORT_INDEX","PARENT_ID","CREATE_USER","CREATE_TIME","UPDATE_TIME","SORT_PATH","IS_ORG_ADMIN","IS_USER_GROUP_ADMIN","CODE","DATA_VERSION") values ('7784ba3204344d37929abd4ad9a1dgth', '数据大屏', 'platform', null, 6, 'twerba3204344d37929abd4ad9a1dfgh', null, null, null, '00060006', 0, 0, 'dataScreen.views.dataScreenList', 0);
insert into "SYS_MENU" ("ID","NAME","PARENT_ID","APP_ID","PARENT_NAME","URL","TYPE","ICON","AUTH_ID","BTN_AUTH","IS_LEAF","SORT_INDEX","ALL_ORDER","SORT_PATH","OPEN_STYLE","CLOSE_NOTICE","CREATE_USER","CREATE_TIME","UPDATE_TIME","LEAF","MENU_AUTH","REMARK","DATA_VERSION","IS_IFRAME") values ('7784ba3204344d37929abd4ad9a1dgth', '数据大屏', 'twerba3204344d37929abd4ad9a1dfgh', 'platform', '数据展示', 'dataScreen/views/dataScreenList', 1, 'iconfont icon-dashboard-fill', '7784ba3204344d37929abd4ad9a1dgth', null, null, 6, null, '00060006', null, null, null, null, null, null, null, null, 0, 0);
insert into "SYS_AUTH_ROLE" ("ID","AUTH_ID","ROLE_ID","SIGN","IS_REVOKE","CREATE_USER","CREATE_TIME","UPDATE_TIME","REMARK") values ('7784ba3204344d37929abd4ad9a1dgth', '7784ba3204344d37929abd4ad9a1dgth', 'appadmin', null, 0, null, null, null, null);
insert into "SYS_AUTH_ROLE_V" ("ID","AUTH_ID","ROLE_ID","SIGN","IS_REVOKE","CREATE_USER","CREATE_TIME","UPDATE_TIME","REMARK","LV_ID") values ('7784ba3204344d37929abd4ad9a1dgth', '7784ba3204344d37929abd4ad9a1dgth', 'appadmin', null, 0, null, null, null, null, 'appadmin');


insert into "SYS_AUTH" ("ID","NAME","APP_ID","REMARK","SORT_INDEX","PARENT_ID","CREATE_USER","CREATE_TIME","UPDATE_TIME","SORT_PATH","IS_ORG_ADMIN","IS_USER_GROUP_ADMIN","CODE","DATA_VERSION") values ('4599ba3204344d37929abd4ad9a1dgth', '地图管理', 'platform', null, 7, 'twerba3204344d37929abd4ad9a1dfgh', null, null, null, '00060007', 0, 0, 'dataScreen.views.dataMapList', 0);
insert into "SYS_MENU" ("ID","NAME","PARENT_ID","APP_ID","PARENT_NAME","URL","TYPE","ICON","AUTH_ID","BTN_AUTH","IS_LEAF","SORT_INDEX","ALL_ORDER","SORT_PATH","OPEN_STYLE","CLOSE_NOTICE","CREATE_USER","CREATE_TIME","UPDATE_TIME","LEAF","MENU_AUTH","REMARK","DATA_VERSION","IS_IFRAME") values ('4599ba3204344d37929abd4ad9a1dgth', '地图管理', 'twerba3204344d37929abd4ad9a1dfgh', 'platform', '数据展示', 'dataScreen/views/dataMapList', 1, 'iconfont icon-map-marked-alt', '4599ba3204344d37929abd4ad9a1dgth', null, null, 7, null, '00060007', null, null, null, null, null, null, null, null, 0, 0);
insert into "SYS_AUTH_ROLE" ("ID","AUTH_ID","ROLE_ID","SIGN","IS_REVOKE","CREATE_USER","CREATE_TIME","UPDATE_TIME","REMARK") values ('4599ba3204344d37929abd4ad9a1dgth', '4599ba3204344d37929abd4ad9a1dgth', 'appadmin', null, 0, null, null, null, null);
insert into "SYS_AUTH_ROLE_V" ("ID","AUTH_ID","ROLE_ID","SIGN","IS_REVOKE","CREATE_USER","CREATE_TIME","UPDATE_TIME","REMARK","LV_ID") values ('4599ba3204344d37929abd4ad9a1dgth', '4599ba3204344d37929abd4ad9a1dgth', 'appadmin', null, 0, null, null, null, null, 'appadmin');
