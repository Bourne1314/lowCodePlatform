/**
2020/04/02
 */
--
-- SYS_COMPONENT_REGISTER  (Table)
--
CREATE TABLE SYS_COMPONENT_REGISTER
(
  ID             VARCHAR2(50 BYTE)              NOT NULL,
  APP_ID         VARCHAR2(50 BYTE),
  NAME           VARCHAR2(50 BYTE),
  COMPONENT_URL  VARCHAR2(200 BYTE),
  AUTH_ID        VARCHAR2(50 BYTE),
  COLUMN_ONE     VARCHAR2(50 BYTE),
  COLUMN_TWO     VARCHAR2(50 BYTE),
  CREATE_TIME    DATE,
  COL_SPAN       INTEGER                         DEFAULT 0
);

COMMENT ON TABLE SYS_COMPONENT_REGISTER IS '应用组件注册表';

COMMENT ON COLUMN SYS_COMPONENT_REGISTER.ID IS '主键';

COMMENT ON COLUMN SYS_COMPONENT_REGISTER.APP_ID IS '应用ID';

COMMENT ON COLUMN SYS_COMPONENT_REGISTER.NAME IS '组件名';

COMMENT ON COLUMN SYS_COMPONENT_REGISTER.COMPONENT_URL IS '组件地址路径';

COMMENT ON COLUMN SYS_COMPONENT_REGISTER.AUTH_ID IS '组件对应的权限ID';

COMMENT ON COLUMN SYS_COMPONENT_REGISTER.COLUMN_ONE IS '字段1';

COMMENT ON COLUMN SYS_COMPONENT_REGISTER.COLUMN_TWO IS '字段2';

COMMENT ON COLUMN SYS_COMPONENT_REGISTER.CREATE_TIME IS '创建时间';

COMMENT ON COLUMN SYS_COMPONENT_REGISTER.COL_SPAN IS '在首页所占列数';



--
-- SYS_COMPONENT_USER  (Table)
--
CREATE TABLE SYS_COMPONENT_USER
(
  ID              VARCHAR2(50 BYTE)             NOT NULL,
  COMPONENT_INFO  CLOB,
  APP_ID          VARCHAR2(50 BYTE),
  USER_ID         VARCHAR2(50 BYTE)
);

COMMENT ON TABLE SYS_COMPONENT_USER IS '普通用户登录应用首页组件排版信息表';

COMMENT ON COLUMN SYS_COMPONENT_USER.ID IS '主键';

COMMENT ON COLUMN SYS_COMPONENT_USER.COMPONENT_INFO IS '组件信息';

COMMENT ON COLUMN SYS_COMPONENT_USER.APP_ID IS '应用ID';

COMMENT ON COLUMN SYS_COMPONENT_USER.USER_ID IS '用户ID';



--
-- SYS_COMPONENT_REGISTER_PK  (Index)
--
CREATE UNIQUE INDEX SYS_COMPONENT_REGISTER_PK ON SYS_COMPONENT_REGISTER
(ID)
LOGGING;


--
-- SYS_COMPONENT_USER_PK  (Index)
--
CREATE UNIQUE INDEX SYS_COMPONENT_USER_PK ON SYS_COMPONENT_USER
(ID)
LOGGING;


--
-- Non Foreign Key Constraints for Table SYS_COMPONENT_REGISTER
--
ALTER TABLE SYS_COMPONENT_REGISTER ADD (
  CONSTRAINT SYS_COMPONENT_REGISTER_PK
  PRIMARY KEY
  (ID)
  USING INDEX SYS_COMPONENT_REGISTER_PK
  ENABLE VALIDATE);

--
-- Non Foreign Key Constraints for Table SYS_COMPONENT_USER
--
ALTER TABLE SYS_COMPONENT_USER ADD (
  CONSTRAINT SYS_COMPONENT_USER_PK
  PRIMARY KEY
  (ID)
  USING INDEX SYS_COMPONENT_USER_PK
  ENABLE VALIDATE);

--
-- Foreign Key Constraints for Table SYS_COMPONENT_REGISTER
--
ALTER TABLE SYS_COMPONENT_REGISTER ADD (
  CONSTRAINT FK_COMPONENT_APP_ID
  FOREIGN KEY (APP_ID)
  REFERENCES SYS_GROUP_APP (ID)
  ON DELETE CASCADE
  ENABLE VALIDATE,
  CONSTRAINT FK_COMPONENT_AUTH_ID
  FOREIGN KEY (AUTH_ID)
  REFERENCES SYS_AUTH (ID)
  ON DELETE SET NULL
  ENABLE VALIDATE);

--
-- Foreign Key Constraints for Table SYS_COMPONENT_USER
--
ALTER TABLE SYS_COMPONENT_USER ADD (
  CONSTRAINT FK_COMPONENT_USER_APP_ID
  FOREIGN KEY (APP_ID)
  REFERENCES SYS_GROUP_APP (ID)
  ON DELETE CASCADE
  ENABLE VALIDATE,
  CONSTRAINT FK_COMPONENT_USER_USER_ID
  FOREIGN KEY (USER_ID)
  REFERENCES SYS_USER (ID)
  ON DELETE CASCADE
  ENABLE VALIDATE);


insert into "SYS_AUTH" ("ID","NAME","APP_ID","REMARK","SORT_INDEX","PARENT_ID","CREATE_USER","CREATE_TIME","UPDATE_TIME","SORT_PATH","IS_ORG_ADMIN","IS_USER_GROUP_ADMIN","CODE","DATA_VERSION") values ('19ea2ad7ea4a4e54acdaff4yhmzq8370', '组件注册', 'platform', null,12, '11316279a4a9416a8e20019821e640af', null, null, null, '00030012', 0, 0, 'platForm.componentRegisterManage.componentRegister', 0);

insert into "SYS_MENU" ("ID","NAME","PARENT_ID","APP_ID","PARENT_NAME","URL","TYPE","ICON","AUTH_ID","BTN_AUTH","IS_LEAF","SORT_INDEX","ALL_ORDER","SORT_PATH","OPEN_STYLE","CLOSE_NOTICE","CREATE_USER","CREATE_TIME","UPDATE_TIME","LEAF","MENU_AUTH","REMARK","DATA_VERSION","IS_IFRAME") values ('19ea2ad7ea4a4e54acdaff4yhmzq8370', '组件注册', '11316279a4a9416a8e20019821e640af', 'platform', '配置管理', 'componentRegisterManage/views/ComponentRegister', 1, 'fa fa-registered', '19ea2ad7ea4a4e54acdaff4yhmzq8370', null, null, 12, null, '00030012', null, null, null, null, null, null, null, null, 0, 0);

insert into "SYS_AUTH_ROLE" ("ID","AUTH_ID","ROLE_ID","SIGN","IS_REVOKE","CREATE_USER","CREATE_TIME","UPDATE_TIME","REMARK") values ('2qwctad7ea4a4e54acdaff4c84bb8370', '19ea2ad7ea4a4e54acdaff4yhmzq8370', 'appadmin', null, 0, null, null, null, null);

insert into "SYS_AUTH_ROLE_V" ("ID","AUTH_ID","ROLE_ID","SIGN","IS_REVOKE","CREATE_USER","CREATE_TIME","UPDATE_TIME","REMARK","LV_ID") values ('29ea2ad7eawdfe54acdafcbc84bb8370', '19ea2ad7ea4a4e54acdaff4yhmzq8370', 'appadmin', null, 0, null, null, null, null, 'appadmin');

/**
2020/4/7
 */
alter table "ORG_DEPARTMENT" add ("IS_ENTITY" INTEGER DEFAULT 1);
comment on column "ORG_DEPARTMENT"."IS_ENTITY" is '是否实体部门';

/**
 * 修改消息通道给应用管理员
 * @author zuogang
 * @date 2020/4/14 8:30
 */
delete from sys_menu where name in ('消息配置','通道扩展');

delete from sys_auth where name in ('消息配置','消息拓展');

delete from sys_auth_role_v where auth_id in ('34116279a4a9416a8e20019821e61341','yut76279a4a9416a8e20019821e6g45t');

update sys_menu set parent_id='11316279a4a9416a8e20019821e640af',PARENT_NAME='配置管理',sort_index=9,sort_path='00030009'   where id='45676279a4a9416a8e20019821e6ghjk';

update sys_auth set parent_id='11316279a4a9416a8e20019821e640af' , sort_index=9, sort_path='00030009' where id='45676279a4a9416a8e20019821e6ghjk';

update sys_auth_role set role_id='appadmin' where role_id='admin' and auth_id='45676279a4a9416a8e20019821e6ghjk';

update sys_auth_role_v set role_id='appadmin',lv_id='appadmin' where auth_id='45676279a4a9416a8e20019821e6ghjk' and lv_id='admin';
/**
 * 消息通道添加APPID字段
 * @author shanwj
 * @date 2020/4/16 18:06
 */
 alter table "SYS_MSG_SEND_TYPE" add ("APP_ID" VARCHAR2(50)); comment on column "SYS_MSG_SEND_TYPE"."APP_ID" is '应用id';

alter table SYS_MSG_SEND_TYPE add constraint "FK_SYS_MSG_SEND_TYPE_APP_ID" foreign key("APP_ID") references "SYS_GROUP_APP"("ID") on delete cascade;

/**
 *  API关联表添加外键
 * @return
 * @author zuogang
 * @date 2020/4/17 10:51
 */
ALTER TABLE "SYS_AUTH_API"
  ADD CONSTRAINT "FK_AUTH_API_API_ID" FOREIGN KEY ("API_ID") REFERENCES "SYS_API_RESOURCE"("ID") ON DELETE CASCADE;

ALTER TABLE "SYS_API_MIX"
  ADD CONSTRAINT "FK_API_MIX_API_ID" FOREIGN KEY ("API_ID") REFERENCES "SYS_API_RESOURCE"("ID") ON DELETE CASCADE;

/**
 *  API关联表添加外键
 * @return
 * @author 单文金
 * @date 2020/4/24 10:51
 */
CREATE TABLE SYS_MICRO_APP
(
ID VARCHAR2(50 BYTE) NOT NULL,
NAME VARCHAR2(1000 BYTE) NOT NULL,
APP_ID VARCHAR2(200 BYTE) NOT NULL,
APP_SECRET VARCHAR2(500 BYTE),
ACCESS_TOKEN VARCHAR2(1000 BYTE),
TYPE VARCHAR2(100 BYTE),
CURRENT_VERSION VARCHAR2(50 BYTE),
AUDIT_VERSION VARCHAR2(50 BYTE),
DATA_VERSION INTEGER DEFAULT 0
);
COMMENT ON TABLE SYS_MICRO_APP IS '平台小程序';
COMMENT ON COLUMN SYS_MICRO_APP.ACCESS_TOKEN IS '小程序token';
COMMENT ON COLUMN SYS_MICRO_APP.APP_ID IS '小程序appId';
COMMENT ON COLUMN SYS_MICRO_APP.APP_SECRET IS '密钥';
COMMENT ON COLUMN SYS_MICRO_APP.ID IS '主键';
COMMENT ON COLUMN SYS_MICRO_APP.NAME IS '名称';
COMMENT ON COLUMN SYS_MICRO_APP.TYPE IS '小程序类型';
COMMENT ON COLUMN SYS_MICRO_APP.AUDIT_VERSION IS '审核版本';
COMMENT ON COLUMN SYS_MICRO_APP.CURRENT_VERSION IS '当前版本';
COMMENT ON COLUMN SYS_MICRO_APP.DATA_VERSION IS '数据版本';

--
-- SYS_MICRO_APP_PK_PK  (Index)
--
CREATE UNIQUE INDEX SYS_MICRO_APP_PK ON SYS_MICRO_APP
(ID)
LOGGING;

--
-- Non Foreign Key Constraints for Table SYS_MICRO_APP_PK
--
ALTER TABLE SYS_MICRO_APP ADD (
  CONSTRAINT SYS_MICRO_APP_PK
  PRIMARY KEY
  (ID)
  USING INDEX SYS_MICRO_APP_PK
  ENABLE VALIDATE);

/**
 *  消息模板
 * @return
 * @author 单文金
 * @date 2020/4/27 10:51
 */
--
-- SYS_MSG_TEMPLATE  (Table)
--
CREATE TABLE SYS_MSG_TEMPLATE
(
  ID                VARCHAR2(50 BYTE)           NOT NULL,
  TEMPLATE_TITLE    VARCHAR2(1000 BYTE),
  AUTH              VARCHAR2(500 BYTE),
  TEMPLATE_CONTENT  VARCHAR2(2000 BYTE),
  TEMPLATE_ID       VARCHAR2(200 BYTE),
  URL               VARCHAR2(200 BYTE),
  CREATE_TIME       DATE,
  CREATE_USER       VARCHAR2(50 BYTE),
  DATA_VERSION      INTEGER                     DEFAULT 0,
  APP_ID            VARCHAR2(50 BYTE)
);

COMMENT ON TABLE SYS_MSG_TEMPLATE IS '消息模板';

COMMENT ON COLUMN SYS_MSG_TEMPLATE.ID IS '主键';

COMMENT ON COLUMN SYS_MSG_TEMPLATE.TEMPLATE_TITLE IS '模板标题';

COMMENT ON COLUMN SYS_MSG_TEMPLATE.AUTH IS '调用权限';

COMMENT ON COLUMN SYS_MSG_TEMPLATE.TEMPLATE_CONTENT IS '模板';

COMMENT ON COLUMN SYS_MSG_TEMPLATE.TEMPLATE_ID IS '模板id';

COMMENT ON COLUMN SYS_MSG_TEMPLATE.URL IS '消息链接';

COMMENT ON COLUMN SYS_MSG_TEMPLATE.CREATE_TIME IS '创建时间';

COMMENT ON COLUMN SYS_MSG_TEMPLATE.CREATE_USER IS '创建人';

COMMENT ON COLUMN SYS_MSG_TEMPLATE.DATA_VERSION IS '数据版本';

COMMENT ON COLUMN SYS_MSG_TEMPLATE.APP_ID IS '应用ID';



--
-- SYS_MSG_TEMPLATE_CONFIG  (Table)
--
CREATE TABLE SYS_MSG_TEMPLATE_CONFIG
(
  ID              VARCHAR2(50 BYTE)             NOT NULL,
  TEMPLATE_ID     VARCHAR2(50 BYTE)             NOT NULL,
  IS_OPEN         NUMBER(1)                     DEFAULT 0                     NOT NULL,
  URL             VARCHAR2(200 BYTE),
  TID             VARCHAR2(50 BYTE),
  TITLE           VARCHAR2(1000 BYTE),
  CONTENT         VARCHAR2(2000 BYTE),
  TYPE            VARCHAR2(100 BYTE),
  MICRO_APP_ID    VARCHAR2(200 BYTE),
  MICRO_APP_NAME  VARCHAR2(200 BYTE)
);

COMMENT ON TABLE SYS_MSG_TEMPLATE_CONFIG IS '信使消息模板配置';

COMMENT ON COLUMN SYS_MSG_TEMPLATE_CONFIG.ID IS '主键';

COMMENT ON COLUMN SYS_MSG_TEMPLATE_CONFIG.TEMPLATE_ID IS '小程序消息模板ID';

COMMENT ON COLUMN SYS_MSG_TEMPLATE_CONFIG.IS_OPEN IS '是否启用0不启用1启用';

COMMENT ON COLUMN SYS_MSG_TEMPLATE_CONFIG.URL IS '链接路径';

COMMENT ON COLUMN SYS_MSG_TEMPLATE_CONFIG.TID IS '平台消息模板id';

COMMENT ON COLUMN SYS_MSG_TEMPLATE_CONFIG.TITLE IS '小程序消息模板标题';

COMMENT ON COLUMN SYS_MSG_TEMPLATE_CONFIG.CONTENT IS '小程序消息模板内容';

COMMENT ON COLUMN SYS_MSG_TEMPLATE_CONFIG.TYPE IS '消息信使类型';

COMMENT ON COLUMN SYS_MSG_TEMPLATE_CONFIG.MICRO_APP_ID IS '小程序标识';

COMMENT ON COLUMN SYS_MSG_TEMPLATE_CONFIG.MICRO_APP_NAME IS '小程序名称';



--
-- SYS_MSG_TEMPLATE_CONFIG_PK  (Index)
--
CREATE UNIQUE INDEX SYS_MSG_TEMPLATE_CONFIG_PK ON SYS_MSG_TEMPLATE_CONFIG
(ID)
LOGGING;


--
-- SYS_MSG_TEMPLATE_PK  (Index)
--
CREATE UNIQUE INDEX SYS_MSG_TEMPLATE_PK ON SYS_MSG_TEMPLATE
(ID)
LOGGING;


--
-- Non Foreign Key Constraints for Table SYS_MSG_TEMPLATE
--
ALTER TABLE SYS_MSG_TEMPLATE ADD (
  CONSTRAINT SYS_MSG_TEMPLATE_PK
  PRIMARY KEY
  (ID)
  USING INDEX SYS_MSG_TEMPLATE_PK
  ENABLE VALIDATE);

--
-- Non Foreign Key Constraints for Table SYS_MSG_TEMPLATE_CONFIG
--
ALTER TABLE SYS_MSG_TEMPLATE_CONFIG ADD (
  CONSTRAINT SYS_MSG_TEMPLATE_CONFIG_PK
  PRIMARY KEY
  (ID)
  USING INDEX SYS_MSG_TEMPLATE_CONFIG_PK
  ENABLE VALIDATE);

--
-- Foreign Key Constraints for Table SYS_MSG_TEMPLATE
--
ALTER TABLE SYS_MSG_TEMPLATE ADD (
  CONSTRAINT FK_SYS_MSG_TEMPLATE_APP_ID
  FOREIGN KEY (APP_ID)
  REFERENCES SYS_GROUP_APP (ID)
  ON DELETE CASCADE
  ENABLE VALIDATE);

--
-- Foreign Key Constraints for Table SYS_MSG_TEMPLATE_CONFIG
--
ALTER TABLE SYS_MSG_TEMPLATE_CONFIG ADD (
  CONSTRAINT FK_SYS_MSG_TEMP_CONFIG_TID
  FOREIGN KEY (TID)
  REFERENCES SYS_MSG_TEMPLATE (ID)
  ON DELETE CASCADE
  ENABLE VALIDATE);


/**
 * 小程序和消息模板菜单分配管理员
 * @author zuogang
 * @date 2020/4/30 10:43
 */
insert into "SYS_AUTH" ("ID","NAME","APP_ID","REMARK","SORT_INDEX","PARENT_ID","CREATE_USER","CREATE_TIME","UPDATE_TIME","SORT_PATH","IS_ORG_ADMIN","IS_USER_GROUP_ADMIN","CODE","DATA_VERSION") values ('vbnmhd7ea4a4e54acdaff4yhmzq8370', '小程序管理', 'platform', null,13, '11316279a4a9416a8e20019821e640af', null, null, null, '00030013', 0, 0, 'platForm.microAppManag.MicroApp', 0);

insert into "SYS_MENU" ("ID","NAME","PARENT_ID","APP_ID","PARENT_NAME","URL","TYPE","ICON","AUTH_ID","BTN_AUTH","IS_LEAF","SORT_INDEX","ALL_ORDER","SORT_PATH","OPEN_STYLE","CLOSE_NOTICE","CREATE_USER","CREATE_TIME","UPDATE_TIME","LEAF","MENU_AUTH","REMARK","DATA_VERSION","IS_IFRAME") values ('vbnmhd7ea4a4e54acdaff4yhmzq8370', '小程序管理', '11316279a4a9416a8e20019821e640af', 'platform', '配置管理', 'microAppManage/views/MicroApp', 1, 'fa fa-cubes', 'vbnmhd7ea4a4e54acdaff4yhmzq8370', null, null, 13, null, '00030013', null, null, null, null, null, null, null, null, 0, 0);

insert into "SYS_AUTH_ROLE" ("ID","AUTH_ID","ROLE_ID","SIGN","IS_REVOKE","CREATE_USER","CREATE_TIME","UPDATE_TIME","REMARK") values ('vrtyhd7ea4a4e54acdaff4yhmzq8370', 'vbnmhd7ea4a4e54acdaff4yhmzq8370', 'groupadmin', null, 0, null, null, null, null);

insert into "SYS_AUTH_ROLE_V" ("ID","AUTH_ID","ROLE_ID","SIGN","IS_REVOKE","CREATE_USER","CREATE_TIME","UPDATE_TIME","REMARK","LV_ID") values ('vrtyhd7ea4a4e54acdaff4yhmzq8370', 'vbnmhd7ea4a4e54acdaff4yhmzq8370', 'groupadmin', null, 0, null, null, null, null, 'groupadmin');


insert into "SYS_AUTH" ("ID","NAME","APP_ID","REMARK","SORT_INDEX","PARENT_ID","CREATE_USER","CREATE_TIME","UPDATE_TIME","SORT_PATH","IS_ORG_ADMIN","IS_USER_GROUP_ADMIN","CODE","DATA_VERSION") values ('bnuimd7ea4a4e54acdaff4yhmzq8370', '消息模板', 'platform', null,14, '11316279a4a9416a8e20019821e640af', null, null, null, '00030014', 0, 0, 'platForm.msgTemplateManage.MsgTemplate', 0);

insert into "SYS_MENU" ("ID","NAME","PARENT_ID","APP_ID","PARENT_NAME","URL","TYPE","ICON","AUTH_ID","BTN_AUTH","IS_LEAF","SORT_INDEX","ALL_ORDER","SORT_PATH","OPEN_STYLE","CLOSE_NOTICE","CREATE_USER","CREATE_TIME","UPDATE_TIME","LEAF","MENU_AUTH","REMARK","DATA_VERSION","IS_IFRAME") values ('bnuimd7ea4a4e54acdaff4yhmzq8370', '消息模板', '11316279a4a9416a8e20019821e640af', 'platform', '配置管理', 'msgTemplateManage/views/MsgTemplate', 1, 'fa fa-comments-o', 'bnuimd7ea4a4e54acdaff4yhmzq8370', null, null, 14, null, '00030014', null, null, null, null, null, null, null, null, 0, 0);

insert into "SYS_AUTH_ROLE" ("ID","AUTH_ID","ROLE_ID","SIGN","IS_REVOKE","CREATE_USER","CREATE_TIME","UPDATE_TIME","REMARK") values ('qwtyhdwea4a4e54acdaff4yhmzq8370', 'bnuimd7ea4a4e54acdaff4yhmzq8370', 'appadmin', null, 0, null, null, null, null);

insert into "SYS_AUTH_ROLE_V" ("ID","AUTH_ID","ROLE_ID","SIGN","IS_REVOKE","CREATE_USER","CREATE_TIME","UPDATE_TIME","REMARK","LV_ID") values ('qwtyhdwea4a4e54acdaff4yhmzq8370', 'bnuimd7ea4a4e54acdaff4yhmzq8370', 'appadmin', null, 0, null, null, null, null, 'appadmin');